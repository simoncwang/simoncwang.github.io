<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <link rel = "stylesheet" href = "../style.css">
    <script src="https://kit.fontawesome.com/9804079aca.js" crossorigin="anonymous"></script>
    <script src="../javascript/util.js"></script>
    <script src="../javascript/theme_change.js"></script>
    <title>Projects</title>
  </head>

  <body>
    <!-- navbar section -->
    <nav id="topnav" class="navbar navbar-expand-lg navbar-light fixed-top">
      <button id="theme-toggle">
        <i id = "theme-icon" class="fa-regular fa-lightbulb"></i>
      </button>
      <div class="container">
        <a class="navbar-brand" href="../index.html">
          <i class="fa-solid fa-cow d-inline-block"></i>
          Simon Wang
      </a>
        <!-- <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button> -->
          <div class="navbar-nav">
            <a class="nav-item nav-link" href="../index.html">Home</a>
            <a class="nav-item nav-link active" href="./defaultproject.html">Projects</a>
            <a class="nav-item nav-link" href="../courses.html">Coursework</a>
            <a class="nav-item nav-link" href="https://scw-blog.vercel.app/" target="_blank">Blog</a>
          </div>
      </div>
      
    </nav>

    <div class="project-page" data-theme-target>
      <!-- sidebar section -->
      <div id="mySidenav" class="sidenav" data-theme-target >
        <div class="collapse">
            <a href="javascript:void(0)" onclick="closeNav()"> &times;</a>
        </div>
    
        <div class="container-fluid" style="text-align:center">
            <!-- Sidebar Title -->
            <hr>

            <div id="header1" class="section-header" onclick="toggleSection('section1','header1')">
              <div class="section-button">School Projects</div>
              <i class="fa-solid fa-angle-up"></i>
            </div>

            <div id="section1" class="section-content show-section">
                <a class="nav-item nav-link" href="./defaultproject.html">MMO - MLLM Benchmarking</a>
                <a class="nav-item nav-link active" href="./disneybrdf.html">Disney BRDF & Monte Carlo Rendering in PyTorch</a>
                <a class="nav-item nav-link" href="./magicalpet.html">MagicalPet - A Desktop AI Assistant</a>
                <a class="nav-item nav-link" href="./videogen.html">Consistent Video Generation</a>
                <a class="nav-item nav-link" href="./vrclass.html">XR Education</a>
                <a class="nav-item nav-link" href="./emd.html">Accessibility of Touch Screens for Elderly</a>
            </div>
            
            <div id="header2" class="section-header" onclick="toggleSection('section2','header2')">
              <button class="section-button">Personal Projects</button>
              <i class="fa-solid fa-angle-down"></i>
            </div>
            
            <div id="section2" class="section-content">
              <a class="nav-item nav-link" href="./personalrag.html">RAG Quiz</a>
              <a class="nav-item nav-link" href="./artadvisor.html">AI Art Advisor</a>
            </div>
            
        </div>
      </div>
    
      <div id="expandBtn" class="expand">
        <a href="javascript:void(0)" onclick="openNav()"> &#9776;</a>
      </div>

      <!-- content section -->
      <div class="container"> 
        <div id = "myContent" class="content">
          <br>
          <h1 style="text-align: center;">Implementation Monte Carlo Rendering and Disney BRDF in PyTorch</h1>
          <h5 style="text-align: center; font-weight:lighter;">How to use code to recreate that Disney wonder we all love! âœ¨</h5>

          <div class="links">

            <div>
              <i class="fa-brands fa-github-alt"></i> <a href="../documents/disneybrdf.pdf" target="_blank">Technical Report</a>
            </div>
            
          </div>

          <br>

          <img src="../images/disneythumbnail.png" class="rounded mx-auto d-block" alt="emd" style="width:60%">
          <center class="image-caption">(yes I know this is just two balls...but look at the shading!)</center>

          <hr>
          <h3>About the project</h3>
          <p>
            This project was built on top of a <b>Monte-Carlo path tracing renderer built in PyTorch</b> as part of my advanced graphics course at UMD (CMSC740 w/ Prof. Zwicker). A skeleton code-base was provided to us as a way to complete course assignments and implement various advanced computer graphics techniques such as sample warping, multiple-importance sampling, neural radiosity, and more! 
          </p>

          <p>
            For my final course project, I used this renderer as the base to implement the <a href="https://media.disneyanimation.com/uploads/production/publication_asset/48/asset/s2012_pbs_disney_brdf_notes_v3.pdf" target="_blank">Disney "principled" BRDF.</a> 
          </p>

          <p>
            NOTE: I am unable to release all of my code for this project, because the base is a private implementation used for the course!
          </p>

          <h3>Motivation/Background</h3>
          <p>
            BRDFs, or <b>bi-directional reflectance distribution functions</b>, are mathematical functions to represent appearance characteristics of materials. This implemented as a continuous function across a surface, describing how light should reflect or scatter at each point.
          </p>

          <p>
            In the technical report "Physically Based Shading at Disney" (linked earlier), the authors describe a new BRDF they implemented with input from graphic artists. It is called "principled", because they <b>prioritize artistic control and ease of use</b>, at times approximating "true" physical accuracy.
          </p>

          <p>
            The result is a shading system with over 10 parameters, allowing appearance to be fine-tuned, demonstrated in various Disney works such as "Wreck-It Ralph"!
          </p>

          <h3>Implementation</h3>
          <p>
            To add the functionality of the Disney BRDF, there are several important functions to implement. 
          </p>

          <p>
            Due to the Monte-Carlo approach of my renderer, <b>light is modeled as large PyTorch tensors of rays</b> (origins and directions), which are then cast out into the 3D scene, calculating what objects they intersect and how that affects the intensity of light they "carry". To render the entire scene, we take many samples per pixel of these rays, essentially integrating over all the light in the scene and creating a nice picture (hopefully).
          </p>

          <p>
            Therefore, in contrast to similar existing implementations online that deal with single vectors, I had to approach this in a batched context, performing operations on Tensors of 3D vectors rather than the vectors individually.
          </p>

          <p>
            After creating a Disney BRDF Python class, I first implement a function that handles <b>sampling distributions depending on the various parameters.</b> To make the parameters in the Disney BRDF work, this involved implementing various sampling functions such as Cosine-Hemisphere sample warping, Fresnel terms, GGX distributions, and more. 
          </p>

          <p>
            Next, we must implement the <b>evaluation function</b>, or how the final colors of pixels is calculated. To do this, I borrowed the existing path tracing structure from my original renderer, then modified it to evaluate light contributions based on functions determined by the Disney parameters.
          </p>

          <h3>Using LLMs to Control Rendering?</h3>
          <p>
            As a secondary experiment, I explored the possiblity of <b>using an LLM (gpt-4o in this case) to control the parameters of the BRDF.</b> Despite the Disney report emphasizing controllability, I found the parameters still a bit hard to tune and somewhat unintuitive (although I am not a graphic artist to be fair...).
          </p>

          <p>
            With over 10 scalar parameters that can be set anywhere from 0 to 1, I found myself quite confused on <b>how to set them correctly to get the appearance I wanted.</b> Certain parameters like "specularity" or "metallic" made a lot of intuitive sense, allowing my to just set them to high numbers to make a shiny ball. However, when you combine them all together and throw in more complicated parameters, it becomes quite difficult to get the results I wanted.
          </p>

          <p>
            My solution here was to use gpt-4o to generate the set of parameters, testing if it has inherent understanding of how BRDF terms relate to appearance. The results were quite promising, with simple natural language prompts producing parameter values that rendered images quite accurate to the intended prompt. For example, when prompted to create "two copper spheres", the model gave parameters that produced some pretty convincing results (will insert image later).
          </p>

          <h3>Results</h3>
          <p>
            Full details can be found in my <a href="../documents/disneybrdf.pdf" target="_blank">technical report</a> but here are some highlights of pictures I rendered using my implementation! (insert here soon)
          </p>
          

          <h3>Future Work</h3>
          <p>
            In the future, I plan to further explore how computer graphics algorithms can create amazing scenes. Rather than just implementing an existing BRDF, I also would like to experiment with creating my own shading system, perhaps controlled by an LLM interface to even further imporve ease-of-use. On that end, I intend to try using structured outputs to improve the reliability of LLM outputs, which is a problem I faced during my experiments (I ended up manually editing the outputs before passing them to my renderer).
          </p>



        </div>
      </div>
    </div>
  

    
<!-- footer section -->
<div class="footer">
  <p>
    &copy; Simon Wang, 2024.
  </p>
  
  <p>
    <a href="https://getbootstrap.com/" target="_blank">
      <img src="../images/bootstrap-logo-black.svg" width="35" height="30" alt="">
    </a>
    &nbsp;
    Created with Bootstrap. &nbsp;
  
    P.s. thanks to the amazing <a href="https://emilywudesign.myportfolio.com/" target="_blank">Emily Wu</a> for helping with the graphic design!
  </p>
</div>

</body>
</html>
